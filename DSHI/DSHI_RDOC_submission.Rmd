```{r}
#note: DSHI now collected during clinical session... future updates not available through qualtrics data pulls
## Make RDOC ready file
ndar_dshi_data <- left_join(DSHI_Wave1,distinct(redcap_cleaned, tagid, dob),by="tagid") %>%
  filter(!is.na(survey_date),!survey_date=="") %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         comments_misc="UO TAG Study",
         visit=ifelse(grepl("Sess 1",survey_name),"Session1",
                      ifelse(grepl("Session 1",survey_name),"Session1",
                             ifelse(grepl("Sess 2",survey_name),"Session2",
                                    ifelse(grepl("Session 2",survey_name),"Session2",
                                           ifelse(grepl("Home",survey_name),"Home Questionnaires",
                                           NA))))),
         gender="F",
         dshi_q1=ifelse(DSHI_1A==2,"N",
                        ifelse(DSHI_1A==2,"Y",NA)),
         dshi_q1a=ifelse(is.numeric(DSHI_1B_1),DSHI_1B_1,NA),
         dshi_q1b=ifelse(is.numeric(DSHI_1B_2),DSHI_1B_2,NA),
         dshi_q1c=ifelse(nchar(as.character(DSHI_1B_3))<11,as.character(DSHI_1B_3),NA),
         dshi_q1d=ifelse(is.numeric(DSHI_1B_4),DSHI_1B_4,NA),
         dshi_q1e=DSHI_1B_5,
         dshi_q2=ifelse(DSHI_2A==2,"N",
                        ifelse(DSHI_2A==2,"Y",NA)),
         dshi_q2a=ifelse(is.numeric(DSHI_2B_1),DSHI_2B_1,NA),
         dshi_q2b=ifelse(is.numeric(DSHI_2B_2),DSHI_2B_2,NA),
         dshi_q2c=ifelse(nchar(as.character(DSHI_2B_3))<11,as.character(DSHI_2B_3),NA),
         dshi_q2d=ifelse(is.numeric(DSHI_2B_4),DSHI_2B_4,NA),
         dshi_q2e=DSHI_2B_5,
         dshi_q3=ifelse(DSHI_3A==2,"N",
                        ifelse(DSHI_3A==2,"Y",NA)),
         dshi_q3a=ifelse(is.numeric(DSHI_3B_1),DSHI_3B_1,NA),
         dshi_q3b=ifelse(is.numeric(DSHI_3B_2),DSHI_3B_2,NA),
         dshi_q3c=ifelse(nchar(as.character(DSHI_3B_3))<11,as.character(DSHI_3B_3),NA),
         dshi_q3d=ifelse(is.numeric(DSHI_3B_4),DSHI_3B_4,NA),
         dshi_q3e=DSHI_3B_5,
         dshi_q4=ifelse(DSHI_4A==2,"N",
                        ifelse(DSHI_4A==2,"Y",NA)),
         dshi_q4a=ifelse(is.numeric(DSHI_4B_1),DSHI_4B_1,NA),
         dshi_q4b=ifelse(is.numeric(DSHI_4B_2),DSHI_4B_2,NA),
         dshi_q4c=ifelse(nchar(as.character(DSHI_4B_3))<11,as.character(DSHI_4B_3),NA),
         dshi_q4d=ifelse(is.numeric(DSHI_4B_4),DSHI_4B_4,NA),
         dshi_q4e=DSHI_4B_5,
         dshi_q5=ifelse(DSHI_5A==2,"N",
                        ifelse(DSHI_5A==2,"Y",NA)),
         dshi_q5a=ifelse(is.numeric(DSHI_5B_1),DSHI_5B_1,NA),
         dshi_q5b=ifelse(is.numeric(DSHI_5B_2),DSHI_5B_2,NA),
         dshi_q5c=ifelse(nchar(as.character(DSHI_5B_3))<11,as.character(DSHI_5B_3),NA),
         dshi_q5d=ifelse(is.numeric(DSHI_5B_4),DSHI_5B_4,NA),
         dshi_q5e=DSHI_5B_5,
         dshi_q6=ifelse(DSHI_6A==2,"N",
                        ifelse(DSHI_6A==2,"Y",NA)),
         dshi_q6a=ifelse(is.numeric(DSHI_6B_1),DSHI_6B_1,NA),
         dshi_q6b=ifelse(is.numeric(DSHI_6B_2),DSHI_6B_2,NA),
         dshi_q6c=ifelse(nchar(as.character(DSHI_6B_3))<11,as.character(DSHI_6B_3),NA),
         dshi_q6d=ifelse(is.numeric(DSHI_6B_4),DSHI_6B_4,NA),
         dshi_q6e=DSHI_6B_5,
         dshi_q7=ifelse(DSHI_7A==2,"N",
                        ifelse(DSHI_7A==2,"Y",NA)),
         dshi_q7a=ifelse(is.numeric(DSHI_7B_1),DSHI_7B_1,NA),
         dshi_q7b=DSHI_7B_2,
         dshi_q7c=ifelse(nchar(as.character(DSHI_7B_3))<11,as.character(DSHI_7B_3),NA),
         dshi_q7d=DSHI_7B_4,
         dshi_q7e=DSHI_7B_5,
         dshi_q8=ifelse(DSHI_8A==2,"N",
                        ifelse(DSHI_8A==2,"Y",NA)),
         dshi_q8a=ifelse(is.numeric(DSHI_8B_1),DSHI_8B_1,NA),
         dshi_q8b=DSHI_8B_2,
         dshi_q8c=ifelse(nchar(as.character(DSHI_8B_3))<11,as.character(DSHI_8B_3),NA),
         dshi_q8d=DSHI_8B_4,
         dshi_q8e=DSHI_8B_5,
         dshi_q9=ifelse(DSHI_9A==2,"N",
                        ifelse(DSHI_9A==2,"Y",NA)),
         dshi_q9a=ifelse("DSHI_9B_1" %in% colnames(DSHI),DSHI_9B_1,NA),
         dshi_q9b=ifelse("DSHI_9B_2" %in% colnames(DSHI),DSHI_9B_2,NA),
         dshi_q9c=ifelse("DSHI_9B_3" %in% colnames(DSHI),DSHI_9B_3,NA),
         dshi_q9d=ifelse("DSHI_9B_4" %in% colnames(DSHI),DSHI_9B_4,NA),
         dshi_q9e=ifelse("DSHI_9B_5" %in% colnames(DSHI),DSHI_9B_5,NA),
         dshi_q10=ifelse(DSHI_10A==2,"N",
                        ifelse(DSHI_10A==2,"Y",NA)),
         dshi_q10a=ifelse("DSHI_10B_1" %in% colnames(DSHI),DSHI_10B_1,NA),
         dshi_q10b=ifelse("DSHI_10B_2" %in% colnames(DSHI),DSHI_10B_2,NA),
         dshi_q10c=ifelse("DSHI_10B_3" %in% colnames(DSHI),DSHI_10B_3,NA),
         dshi_q10d=ifelse("DSHI_10B_4" %in% colnames(DSHI),DSHI_10B_4,NA),
         dshi_q10e=ifelse("DSHI_10B_5" %in% colnames(DSHI),DSHI_10B_5,NA),
         dshi_q11=ifelse(DSHI_11A==2,"N",
                        ifelse(DSHI_11A==2,"Y",NA)),
         dshi_q11a=ifelse(is.numeric(DSHI_11B_1),DSHI_11B_1,NA),
         dshi_q11b=ifelse(is.numeric(DSHI_11B_2),DSHI_11B_2,NA),
         dshi_q11c=ifelse(nchar(as.character(DSHI_11B_3))<11,as.character(DSHI_11B_3),NA),
         dshi_q11d=DSHI_11B_4,
         dshi_q11e=DSHI_11B_5,
         dshi_q12=ifelse(DSHI_12A==2,"N",
                        ifelse(DSHI_12A==2,"Y",NA)),
         dshi_q12a=ifelse("DSHI_12B_1" %in% colnames(DSHI),DSHI_12B_1,NA),
         dshi_q12b=ifelse("DSHI_12B_2" %in% colnames(DSHI),DSHI_12B_2,NA),
         dshi_q12c=ifelse("DSHI_12B_3" %in% colnames(DSHI),DSHI_12B_3,NA),
         dshi_q12d=ifelse("DSHI_12B_4" %in% colnames(DSHI),DSHI_12B_4,NA),
         dshi_q12e=ifelse("DSHI_12B_5" %in% colnames(DSHI),DSHI_12B_5,NA),
         dshi_q13=ifelse(DSHI_13A==2,"N",
                        ifelse(DSHI_13A==2,"Y",NA)),
         dshi_q13a=ifelse("DSHI_13B_1" %in% colnames(DSHI),DSHI_13B_1,NA),
         dshi_q13b=ifelse("DSHI_13B_2" %in% colnames(DSHI),DSHI_13B_2,NA),
         dshi_q13c=ifelse("DSHI_13B_3" %in% colnames(DSHI),DSHI_13B_3,NA),
         dshi_q13d=ifelse("DSHI_13B_4" %in% colnames(DSHI),DSHI_13B_4,NA),
         dshi_q13e=ifelse("DSHI_13B_5" %in% colnames(DSHI),DSHI_13B_5,NA),
         dshi_q14=ifelse(DSHI_14A==2,"N",
                        ifelse(DSHI_14A==2,"Y",NA)),
         dshi_q14a=ifelse(is.numeric(DSHI_14B_1),DSHI_14B_1,NA),
         dshi_q14b=ifelse(is.numeric(DSHI_14B_2),DSHI_14B_2,NA),
         dshi_q14c=ifelse(nchar(as.character(DSHI_14B_3))<11,as.character(DSHI_14B_3),NA),
         dshi_q14d=ifelse(is.numeric(DSHI_14B_4),DSHI_14B_4,NA),
         dshi_q14e=DSHI_14B_5,
         dshi_q15=ifelse(DSHI_15A==2,"N",
                        ifelse(DSHI_15A==2,"Y",NA)),
         dshi_q15a=DSHI_15B_1,
         dshi_q15b=DSHI_15B_2,
         dshi_q15c=ifelse(nchar(as.character(DSHI_15B_3))<11,as.character(DSHI_15B_3),NA),
         dshi_q15d=DSHI_15B_4,
         dshi_q15e=DSHI_15B_5,
         dshi_q16=ifelse(DSHI_16A==2,"N",
                        ifelse(DSHI_16A==2,"Y",NA)),
         dshi_q16a=ifelse(is.numeric(DSHI_16B_1),DSHI_16B_1,NA),
         dshi_q16b=ifelse(is.numeric(DSHI_16B_2),DSHI_16B_2,NA),
         dshi_q16c=ifelse(nchar(as.character(DSHI_16B_3))<11,as.character(DSHI_16B_3),NA),
         dshi_q16d=ifelse(is.numeric(DSHI_16B_4),DSHI_16B_4,NA),
         dshi_q16e=DSHI_16B_5,
         dshi_q17=ifelse(DSHI_17A==2,"N",
                        ifelse(DSHI_17A==2,"Y",NA)),
         dshi_q17a=ifelse(is.numeric(DSHI_17B_1),DSHI_17B_1,NA),
         dshi_q17b=ifelse(is.numeric(DSHI_17B_2),DSHI_17B_2,NA),
         dshi_q17c=ifelse(nchar(as.character(DSHI_17B_3))<11,as.character(DSHI_17B_3),NA),
         dshi_q17d=ifelse(is.numeric(DSHI_17B_4),DSHI_17B_4,NA),
         dshi_q17e=DSHI_17B_5,
         dshi_totalscore=-999)

#ndar_dshi_data <- filter(ndar_dshi_data, 
#                         survey_name != 'TAG - Sess 1 - V3', tagid != 'TAG042')
ndar_dshi_data <- left_join(ndar_key,ndar_dshi_data, by="tagid") %>%
  mutate(src_subject_id=anontagid,
         subjectkey=guid) %>%
  filter(!is.na(subjectkey),
         !interview_age=="") %>%
  select(-contains("DSHI",ignore.case = FALSE),-dob,-survey_date,-survey_name,-tagid,-anontagid,-ID,-guid,-survey_type)
dshi_df_header<-rep(NA,length(read.csv(paste0(workdir,"RDoCdb/templates/dshi01_template.csv"), header = FALSE, stringsAsFactors = FALSE)))
dshi_df_header[1]<-read.csv(paste0(workdir,"RDoCdb/templates/dshi01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,1]
dshi_df_header[2]<-read.csv(paste0(workdir,"RDoCdb/templates/dshi01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,2]

dshi_temp<-as.list(read.csv(paste0(workdir,"RDoCdb/templates/dshi01_template.csv"), header = TRUE, stringsAsFactors = FALSE, skip=1))
dshi_temp_df<-data.frame(dshi_temp)
ndar_dshi_data<-bind_rows(dshi_temp_df,ndar_dshi_data)

part2<-colnames(ndar_dshi_data)
part3<-as.matrix(ndar_dshi_data)
colnames(part3)<-NULL
together<-rbind(dshi_df_header,part2,part3)
write.table(together,file =paste0(workdir,"RDoCdb/output/dec2019/dshi01.csv"),sep=",",na = "",row.names=FALSE,col.names=FALSE)
rm(together,part2,part3,dshi_df_header,dshi_temp,dshi_temp_df,DSHI,DSHI_Wave1)
```
