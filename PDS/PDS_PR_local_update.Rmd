Prepare Parent-report PDS
```{r}
PDS_parent<-left_join(filter(cleaned_survey_data, grepl("Parent",survey_name)) %>%
                  filter(grepl("PDS",item)) %>% 
                    mutate(value=as.numeric(value)) %>% 
                  filter(!is.na(value), !value=="") %>%
                 filter(!grepl("TAG110",tagid) | !grepl("W2",survey_name)) %>% 
                  distinct(tagid,item,value,survey_name,.keep_all = FALSE) %>% 
                  spread(item,value),
                redcap_cleaned %>%
                  filter(!is.na(dob),!is.na(sa_date)) %>%
                  dplyr::select(tagid, sa_date, sb_date, dob),by="tagid")

PDS_parent <- as.data.frame(PDS_parent)

PDS_parent <- rbind(PDS_parent, c("TAG110", "W1 Parent - Relabelled", 3, 1, 2, 3, 3, 0, 10, 5, "2017-07-14", "2017-08-11", "2007-06-15"))
PDS_parent <- rbind(PDS_parent, c("TAG110", "W2 Parent - Relabelled", 3, 1, 2, 3, 3, 0, 16, 8, "2018-12-11", "2019-01-12", "2007-06-15"))

PDS_parent_Wave1<-left_join(PDS_parent,survey_date, by = c("tagid","survey_name")) %>% 
  distinct(tagid,survey_name,.keep_all = TRUE) %>%
  mutate(qualtrics_date=value) %>% 
  dplyr::select(-value) %>%
  mutate(survey_date=ifelse(survey_name=="TAG - Parent Questionnaires V1",sa_date,
                            ifelse(survey_name=="TAG - Parent Questionnaires - V2 - Current",sa_date,
                                   ifelse(survey_name=="W1 Parent - Relabelled", sa_date, 
                                          ifelse(survey_name=="W2 Parent - Relabelled", sa_date, 
                                   as.character(qualtrics_date)
                                          ))))) %>%
  dplyr::select(-qualtrics_date,-sb_date,-sa_date,-dob) %>%
  mutate(peta=PDS_F1,
         petb=PDS_F2,
         petc=PDS_F3,
         petd=PDS_F4,
         pete=PDS_F5,
         fpete=PDS_F6,
         petaf=ifelse(PDS_F1==1,1,
                      ifelse(PDS_F1==2,2,
                             ifelse(PDS_F1==3,3,
                                    ifelse(PDS_F1==4,5,
                                           NA)))),
         petbf=ifelse(PDS_F2==1,1,
                      ifelse(PDS_F2==2,2,
                             ifelse(PDS_F2==3,4,
                                    ifelse(PDS_F2==4,5,
                                           NA)))),
         petcf=ifelse(PDS_F3==1,1,
                      ifelse(PDS_F3==2,2,
                             ifelse(PDS_F3==3,4,
                                    ifelse(PDS_F3==4,5,
                                           NA)))),
         petdf=ifelse(PDS_F4==1,1,
                      ifelse(PDS_F4==2,3,
                             ifelse(PDS_F4==3,4,
                                    ifelse(PDS_F4==4,5,
                                           NA)))),         
         petef=ifelse(PDS_F6==0,1,
                      ifelse(PDS_F6==1,5,
                             NA))) %>%
  mutate(adrenf=rowMeans(cbind(petbf,petcf),na.rm=F)) %>%
  mutate(adrenf2=ifelse(adrenf==1,1,
                        ifelse(petb==1 & adrenf==1.5,1,
                               ifelse(petb==2 & adrenf==1.5,2,
                                      ifelse(adrenf==2,2,
                                             ifelse(adrenf==2.5,3,
                                                    ifelse(adrenf==3,3,
                                                           ifelse(adrenf==3.5,4,
                                                                  ifelse(adrenf==4,4,
                                                                         ifelse(adrenf==4.5,5,
                                                                                ifelse(adrenf==5,5,
                                                                                       NA))))))))))) %>%
  mutate(gonadf=rowMeans(cbind(petaf,petdf),na.rm=F)) %>%
  mutate(gonadf2=ifelse(gonadf==1 & petef==1,1,
                        ifelse(gonadf==1.5 & petef==1,1,
                               ifelse(gonadf==2 & petef==1,2,
                                      ifelse(gonadf==2.5 & petef==1,2,
                                             ifelse(gonadf==3 & petef==1,3,
                                                    ifelse(gonadf==3.5 & petef==1,3,
                                                           ifelse(gonadf==4 & petef==1,3,
                                                                  ifelse(gonadf==4.5 & petef==1,4,
                                                                         ifelse(gonadf==5 & petef==1,4,
                                                                                ifelse(gonadf==1 & petef==5,2,
                                                                                       ifelse(gonadf==1.5 & petef==5,3,
                                                                                              ifelse(gonadf==2 & petef==5,4,
                                                                                                     ifelse(gonadf==2.5 & petef==5,4,
                                                                                                            ifelse(gonadf==3 & petef==5,4,
                                                                                                                   ifelse(gonadf==3.5 & petef==5,5,
                                                                                                                          ifelse(gonadf==4 & petef==5,5,
                                                                                                                                 ifelse(gonadf==4.5 & petef==5,5,
                                                                                                                                        ifelse(gonadf==5 & petef==5,5,
                                                                                                                                               NA))))))))))))))))))) %>%
  mutate(pdss=rowMeans(cbind(adrenf2,gonadf2),na.rm=F),
         pdss_N=5,
         pdss_missing=rowSums(is.na(cbind(PDS_F1,PDS_F2,PDS_F3,PDS_F4,PDS_F6))),
         pdss_missing_perc=100*(rowSums(is.na(cbind(PDS_F1,PDS_F2,PDS_F3,PDS_F4,PDS_F6)))/5),
         adrenf2_N=2,
         adrenf2_missing=rowSums(is.na(cbind(PDS_F2,PDS_F3))),
         adrenf2_missing_perc=100*(rowSums(is.na(cbind(PDS_F2,PDS_F3)))/2),
         gonadf2_N=3,
         gonadf2_missing=rowSums(is.na(cbind(PDS_F1,PDS_F4,PDS_F6))),
         gonadf2_missing_perc=100*(rowSums(is.na(cbind(PDS_F1,PDS_F4,PDS_F6)))/3),
         ) #NV added perc missing      

PDS_parent_Wave1$survey_type <- ifelse(PDS_parent_Wave1$tagid=="TAG110", "Parent", PDS_parent_Wave1$survey_type)

## Save it
PDS_parent_Wave1_outdf <- PDS_parent_Wave1 %>% filter(!grepl("W2|W3|W4|W5|W6",survey_name)) %>% 
  filter(!grepl("TAG3|TAG4",tagid))
PDS_parent_Wave1_TAG2_outdf <- PDS_parent_Wave1 %>% filter(!grepl("W2|W3|W4|W5|W6",survey_name)) %>% 
  filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(PDS_parent_Wave1_outdf, file = paste0(workdir,"Qualtrics_Output/Wave1/PDS_parent_Wave1.csv"))
write.csv(PDS_parent_Wave1_TAG2_outdf, 
          file = paste0(workdir,"Qualtrics_Output/Wave1/PDS_parent_Wave1_TAG2.csv"))

PDS_parent_Wave2_outdf <- PDS_parent_Wave1 %>% filter(grepl("W2",survey_name)) %>% filter(!grepl("TAG3|TAG4",tagid))
write.csv(PDS_parent_Wave2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave2/PDS_parent_Wave2.csv"))

PDS_parent_Wave2_TAG2_outdf <- PDS_parent_Wave1 %>% filter(grepl("W2",survey_name)) %>% filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(PDS_parent_Wave2_TAG2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave2/PDS_parent_Wave2_TAG2.csv"))

PDS_parent_Wave3_outdf <- PDS_parent_Wave1 %>% filter(grepl("W3",survey_name)) %>% filter(!grepl("TAG3|TAG4",tagid)) 
write.csv(PDS_parent_Wave3_outdf, file = paste0(workdir,"Qualtrics_Output/Wave3/PDS_parent_Wave3.csv"))

PDS_parent_Wave3_TAG2_outdf <- PDS_parent_Wave1 %>% filter(grepl("W3",survey_name)) %>% filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(PDS_parent_Wave3_TAG2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave3/PDS_parent_Wave3_TAG2.csv"))

PDS_parent_Wave4_outdf <- PDS_parent_Wave1 %>% filter(grepl("W4",survey_name)) 
write.csv(PDS_parent_Wave4_outdf, file = paste0(workdir,"Qualtrics_Output/Wave4/PDS_parent_Wave4.csv"))

PDS_parent_Wave5_outdf <- PDS_parent_Wave1 %>% filter(grepl("W5",survey_name)) 
write.csv(PDS_parent_Wave5_outdf, file = paste0(workdir,"Qualtrics_Output/Wave5/PDS_parent_Wave5.csv"))

PDS_parent_Wave6_outdf <- PDS_parent_Wave1 %>% filter(grepl("W6",survey_name)) 
write.csv(PDS_parent_Wave6_outdf, file = paste0(workdir,"Qualtrics_Output/Wave6/PDS_parent_Wave6.csv"))
```
