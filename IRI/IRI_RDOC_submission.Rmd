```{r}
## Make RDOC ready file
ndar_iri_data <- left_join(IRI_Wave1,distinct(redcap_cleaned, tagid, dob),by="tagid") %>%
  filter(!is.na(survey_date),!survey_date=="") %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         sex="F",
         comments_misc=ifelse(grepl("Sess 1",survey_name),"Session1",
                              ifelse(grepl("Sess 2",survey_name),"Session2",
                                     ifelse(grepl("Home",survey_name),"Home Questionnaires",NA))),
         #gender="F",
         daydream=IRI_1,
         tender_feelings=IRI_2,
         difficult_other_pov=IRI_3,
         dont_feel_sorry_problems=IRI_4,
         involved_characters=IRI_5,
         emergency_apprehension=IRI_6,
         objective_watching=IRI_7,
         all_sides_disagreement=IRI_8,
         protective=IRI_9,
         helpless=IRI_10,
         other_perspective=IRI_11,
         involved_rare=IRI_12,
         hurt_stay_calm=IRI_13,
         misfortunes_not_disturbed=IRI_14,
         arguments_dont_listen=IRI_15,
         movie_characters=IRI_16,
         tense_emotional=IRI_17,
         unfairly_pity=IRI_18,
         effective_emergencies=IRI_19,
         touched=IRI_20,
         see_both_sides=IRI_21,
         describe_soft_hearted=IRI_22,
         movie_characters_relate=IRI_23,
         emergencies_lose_control=IRI_24,
         upset_try_shoes=IRI_25,
         novel_if_in_story=IRI_26,
         help_go_to_pieces=IRI_27,
         before_criticizing=IRI_28,
         iripd=ifelse(is.na(IRI_PD_total),999,IRI_PD_total),
         iript=ifelse(is.na(IRI_PT_total),999,IRI_PT_total),
         iriec=ifelse(is.na(IRI_EC_total),999,IRI_EC_total),
         irifs=ifelse(is.na(IRI_FS_total),999,IRI_FS_total))
ndar_iri_data <- left_join(ndar_key,ndar_iri_data, by="tagid") %>%
  mutate(src_subject_id=anontagid,
         subjectkey=guid) %>%
  filter(!is.na(subjectkey),
         !interview_age=="") %>%
  select(-contains("IRI",ignore.case = FALSE),-dob,-survey_date,-survey_name,-tagid,-anontagid,-ID,-guid,-survey_type)
iri_df_header<-rep(NA,length(read.csv(paste0(workdir,"RDoCdb/templates/iri01_template.csv"), header = FALSE, stringsAsFactors = FALSE)))
iri_df_header[1]<-read.csv(paste0(workdir,"RDoCdb/templates/iri01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,1]
iri_df_header[2]<-read.csv(paste0(workdir,"RDoCdb/templates/iri01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,2]

iri_temp<-as.list(read.csv(paste0(workdir,"RDoCdb/templates/iri01_template.csv"), header = TRUE, stringsAsFactors = FALSE, skip=1))
iri_temp_df<-data.frame(iri_temp)
ndar_iri_data<-rbind(iri_temp_df,ndar_iri_data)

part2<-colnames(ndar_iri_data)
part3<-as.matrix(ndar_iri_data)
colnames(part3)<-NULL
together<-rbind(iri_df_header,part2,part3)
write.table(together,file =paste0(workdir,"RDoCdb/output/jul2025/iri01.csv"),sep=",",na = "",row.names=FALSE,col.names=FALSE)
rm(together,part2,part3,iri_df_header,iri_temp,iri_temp_df,IRI,IRI_Wave1,IRI_Wave1_means,IRI_Wave1_means_graph,IRI_Wave1_totals,IRI_Wave1_totals_graph)

```
