Prepare RMET
```{r}
RMET<-left_join(filter(cleaned_survey_data, grepl("RMET",item)) %>%
                 mutate(value=as.numeric(value)) %>% 
                 filter(!is.na(value)) %>%
                 filter(!value=="") %>%
                 distinct(tagid,item,value,survey_name,.keep_all = FALSE) %>% 
                 spread(item,value),
               redcap_cleaned %>%
                 filter(!is.na(dob),!is.na(sa_date)) %>%
                 dplyr::select(tagid, sa_date, sb_date, dob),by="tagid")

if (length(RMET$tagid) == length(unique(RMET$tagid))){
  print("No duplicate TAGIDs in data")
}

RMET_Wave1<-left_join(RMET,survey_date, by = c("tagid","survey_name")) %>% 
  distinct(tagid,survey_name,.keep_all = TRUE) %>%
  mutate(qualtrics_date=value) %>%
  dplyr::select(-value)%>%
  mutate(survey_date=ifelse(survey_name=="TAG - Sess 2 - V1",sb_date,
                            ifelse(survey_name=="TAG - Sess 1 - V2",sa_date,
                                   ifelse(survey_name=="TAG - Sess 1 - V3",sa_date,
                                          ifelse(survey_name=="TAG - Sess 1 - V4 - Current",sa_date,
                                                 ifelse(survey_name=="Sensitive Q's for 042",sb_date,as.character(qualtrics_date)
                                                 )))))) %>%
  dplyr::select(-qualtrics_date,-sb_date,-sa_date,-dob) %>% 
  mutate(RMET_1_correct=ifelse(RMET_1==1,0,
                               ifelse(RMET_1==2,0,
                                      ifelse(RMET_1==3,1,
                                             ifelse(RMET_1==4,0,NA)))),
         RMET_2_correct=ifelse(RMET_2==1,0,
                               ifelse(RMET_2==2,0,
                                      ifelse(RMET_2==3,0,
                                             ifelse(RMET_2==4,1,NA)))),
         RMET_3_correct=ifelse(RMET_3==1,1,
                               ifelse(RMET_3==2,0,
                                      ifelse(RMET_3==3,0,
                                             ifelse(RMET_3==4,0,NA)))),
         RMET_4_correct=ifelse(RMET_4==1,0,
                               ifelse(RMET_4==2,1,
                                      ifelse(RMET_4==3,0,
                                             ifelse(RMET_4==4,0,NA)))),
         RMET_5_correct=ifelse(RMET_5==1,0,
                               ifelse(RMET_5==2,1,
                                      ifelse(RMET_5==3,0,
                                             ifelse(RMET_5==4,0,NA)))),
         RMET_6_correct=ifelse(RMET_6==1,0,
                               ifelse(RMET_6==2,0,
                                      ifelse(RMET_6==3,1,
                                             ifelse(RMET_6==4,0,NA)))),
         RMET_7_correct=ifelse(RMET_7==1,0,
                               ifelse(RMET_7==2,0,
                                      ifelse(RMET_7==3,1,
                                             ifelse(RMET_7==4,0,NA)))),
         RMET_8_correct=ifelse(RMET_8==1,1,
                               ifelse(RMET_8==2,0,
                                      ifelse(RMET_8==3,0,
                                             ifelse(RMET_8==4,0,NA)))),
         RMET_9_correct=ifelse(RMET_9==1,0,
                               ifelse(RMET_9==2,0,
                                      ifelse(RMET_9==3,0,
                                             ifelse(RMET_9==4,1,NA)))),
         RMET_10_correct=ifelse(RMET_10==1,0,
                               ifelse(RMET_10==2,0,
                                      ifelse(RMET_10==3,1,
                                             ifelse(RMET_10==4,0,NA)))),
         RMET_11_correct=ifelse(RMET_11==1,0,
                               ifelse(RMET_11==2,1,
                                      ifelse(RMET_11==3,0,
                                             ifelse(RMET_11==4,0,NA)))),
         RMET_12_correct=ifelse(RMET_12==1,0,
                               ifelse(RMET_12==2,0,
                                      ifelse(RMET_12==3,0,
                                             ifelse(RMET_12==4,1,NA)))),
         RMET_13_correct=ifelse(RMET_13==1,1,
                               ifelse(RMET_13==2,0,
                                      ifelse(RMET_13==3,0,
                                             ifelse(RMET_13==4,0,NA)))),
         RMET_14_correct=ifelse(RMET_14==1,0,
                               ifelse(RMET_14==2,1,
                                      ifelse(RMET_14==3,0,
                                             ifelse(RMET_14==4,0,NA)))),
         RMET_15_correct=ifelse(RMET_15==1,1,
                               ifelse(RMET_15==2,0,
                                      ifelse(RMET_15==3,0,
                                             ifelse(RMET_15==4,0,NA)))),
         RMET_16_correct=ifelse(RMET_16==1,1,
                               ifelse(RMET_16==2,0,
                                      ifelse(RMET_16==3,0,
                                             ifelse(RMET_16==4,0,NA)))),
         RMET_17_correct=ifelse(RMET_17==1,0,
                               ifelse(RMET_17==2,0,
                                      ifelse(RMET_17==3,0,
                                             ifelse(RMET_17==4,1,NA)))),
         RMET_18_correct=ifelse(RMET_18==1,1,
                               ifelse(RMET_18==2,0,
                                      ifelse(RMET_18==3,0,
                                             ifelse(RMET_18==4,0,NA)))),
         RMET_19_correct=ifelse(RMET_19==1,0,
                               ifelse(RMET_19==2,0,
                                      ifelse(RMET_19==3,0,
                                             ifelse(RMET_19==4,1,NA)))),
         RMET_20_correct=ifelse(RMET_20==1,0,
                               ifelse(RMET_20==2,0,
                                      ifelse(RMET_20==3,1,
                                             ifelse(RMET_20==4,0,NA)))),
         RMET_21_correct=ifelse(RMET_21==1,1,
                               ifelse(RMET_21==2,0,
                                      ifelse(RMET_21==3,0,
                                             ifelse(RMET_21==4,0,NA)))),
         RMET_22_correct=ifelse(RMET_22==1,0,
                               ifelse(RMET_22==2,0,
                                      ifelse(RMET_22==3,0,
                                             ifelse(RMET_22==4,1,NA)))),
         RMET_23_correct=ifelse(RMET_23==1,0,
                               ifelse(RMET_23==2,1,
                                      ifelse(RMET_23==3,0,
                                             ifelse(RMET_23==4,0,NA)))),
         RMET_24_correct=ifelse(RMET_24==1,1,
                               ifelse(RMET_24==2,0,
                                      ifelse(RMET_24==3,0,
                                             ifelse(RMET_24==4,0,NA)))),
         RMET_25_correct=ifelse(RMET_25==1,0,
                               ifelse(RMET_25==2,0,
                                      ifelse(RMET_25==3,0,
                                             ifelse(RMET_25==4,1,NA)))),
         RMET_26_correct=ifelse(RMET_26==1,0,
                               ifelse(RMET_26==2,0,
                                      ifelse(RMET_26==3,1,
                                             ifelse(RMET_26==4,0,NA)))),
         RMET_27_correct=ifelse(RMET_27==1,0,
                               ifelse(RMET_27==2,0,
                                      ifelse(RMET_27==3,1,
                                             ifelse(RMET_27==4,0,NA)))),
         RMET_28_correct=ifelse(RMET_28==1,0,
                               ifelse(RMET_28==2,0,
                                      ifelse(RMET_28==3,1,
                                             ifelse(RMET_28==4,0,NA)))),
         RMET_missing=rowSums(is.na(cbind(RMET_1,RMET_2,RMET_3,RMET_4,RMET_5,RMET_6,
                                          RMET_7,RMET_8,RMET_9,RMET_10,RMET_11,RMET_12,
                                          RMET_13,RMET_14,RMET_15,RMET_16,RMET_17,
                                          RMET_18,RMET_19,RMET_20,RMET_21,RMET_22,
                                          RMET_23,RMET_24,RMET_25,RMET_26,
                                          RMET_27,RMET_28))))%>%
  mutate(RMET_1_numcompleted=(28-RMET_missing),
         RMET_Total_Score=rowSums(cbind(RMET_1_correct,RMET_2_correct,
                                        RMET_3_correct,RMET_4_correct,
                                        RMET_5_correct,RMET_6_correct,
                                        RMET_7_correct,RMET_8_correct,
                                        RMET_9_correct,RMET_10_correct,
                                        RMET_11_correct,RMET_12_correct,
                                        RMET_13_correct,RMET_14_correct,
                                        RMET_15_correct,RMET_16_correct,
                                        RMET_17_correct,RMET_18_correct,
                                        RMET_19_correct,RMET_20_correct,
                                        RMET_21_correct,RMET_22_correct,
                                        RMET_23_correct,RMET_24_correct,
                                        RMET_25_correct,RMET_26_correct,
                                        RMET_27_correct,RMET_28_correct),na.rm = F)) %>%
  mutate(RMET_Percent_Correct=(rowSums(cbind(RMET_1_correct,RMET_2_correct,
                                        RMET_3_correct,RMET_4_correct,
                                        RMET_5_correct,RMET_6_correct,
                                        RMET_7_correct,RMET_8_correct,
                                        RMET_9_correct,RMET_10_correct,
                                        RMET_11_correct,RMET_12_correct,
                                        RMET_13_correct,RMET_14_correct,
                                        RMET_15_correct,RMET_16_correct,
                                        RMET_17_correct,RMET_18_correct,
                                        RMET_19_correct,RMET_20_correct,
                                        RMET_21_correct,RMET_22_correct,
                                        RMET_23_correct,RMET_24_correct,
                                        RMET_25_correct,RMET_26_correct,
                                        RMET_27_correct,RMET_28_correct),na.rm = T)/RMET_1_numcompleted)*100)
## Save it
RMET_Wave1_outdf <- RMET_Wave1 %>% filter(!grepl("W2|W3|W4|W5|W6",survey_name)) %>% 
  filter(!grepl("TAG3|TAG4",tagid))
RMET_Wave1_TAG2_outdf <- RMET_Wave1 %>% filter(!grepl("W2|W3|W4|W5|W6",survey_name)) %>% 
  filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(RMET_Wave1_outdf, file = paste0(workdir,"Qualtrics_Output/Wave1/RMET_Wave1.csv"))
write.csv(RMET_Wave1_TAG2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave1/RMET_Wave1_TAG2.csv"))

RMET_Wave2_outdf <- RMET_Wave1 %>% filter(grepl("W2",survey_name)) %>% filter(!grepl("TAG3|TAG4",tagid))
write.csv(RMET_Wave2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave2/RMET_Wave2.csv"))

RMET_Wave2_TAG2_outdf <- RMET_Wave1 %>% filter(grepl("W2",survey_name)) %>% filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(RMET_Wave2_TAG2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave2/RMET_Wave2_TAG2.csv"))

RMET_Wave3_outdf <- RMET_Wave1 %>% filter(grepl("W3",survey_name)) %>% filter(!grepl("TAG3|TAG4",tagid)) 
write.csv(RMET_Wave3_outdf, file = paste0(workdir,"Qualtrics_Output/Wave3/RMET_Wave3.csv"))

RMET_Wave3_TAG2_outdf <- RMET_Wave1 %>% filter(grepl("W3",survey_name)) %>% filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(RMET_Wave3_TAG2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave3/RMET_Wave3_TAG2.csv"))

#RMET discontinued after W3
RMET_Wave4_outdf <- RMET_Wave1 %>% filter(grepl("W4",survey_name)) 
#write.csv(RMET_Wave4_outdf, file = paste0(workdir,"Qualtrics_Output/Wave4/RMET_Wave4.csv"))
```
