Prepare CRQ
```{r}
CRQ <- left_join(filter(cleaned_survey_data, grepl("CRQ",item)) %>%
                   mutate(value=as.numeric(value)) %>% 
                   filter(!is.na(value)) %>%  
                   distinct(tagid,item,value,survey_name,.keep_all = FALSE) %>%
                   spread(item,value),redcap_cleaned %>%
                 filter(!is.na(dob),!is.na(sa_date)) %>%
                 dplyr::select(tagid, sa_date, sb_date, dob),by="tagid")

CRQ_Wave1<-left_join(CRQ,survey_date, by = c("tagid","survey_name")) %>% 
  distinct(tagid,survey_name,.keep_all = TRUE) %>%
  mutate(qualtrics_date=value) %>% 
  dplyr::select(-value) %>%
  mutate(survey_date=ifelse(survey_name=="TAG - Sess 2 - V1",sb_date,
                            ifelse(survey_name=="TAG - Sess 1 - V2",sa_date,
                                   ifelse(survey_name=="TAG - Sess 1 - V4 - Current",sa_date,
                                          ifelse(survey_name=="Sensitive Q's for 042",sb_date,as.character(qualtrics_date)
                                          ))))) %>%
  dplyr::select(-qualtrics_date,-sb_date,-sa_date,-dob) %>%
  mutate(CRQ_N=27,
         CRQ_missing=rowSums(is.na(cbind(CRQ_1,CRQ_2,CRQ_3,CRQ_4,CRQ_5,CRQ_6,CRQ_7,CRQ_8,CRQ_9,CRQ_10,CRQ_11,CRQ_12,CRQ_13,CRQ_14,CRQ_15,CRQ_16,CRQ_17,CRQ_18,CRQ_19,CRQ_20,CRQ_21,CRQ_22,CRQ_23,CRQ_24,CRQ_25,CRQ_26,CRQ_27))),
         CRQ_missing_perc=100*(rowSums(is.na(cbind(CRQ_1,CRQ_2,CRQ_3,CRQ_4,CRQ_5,CRQ_6,CRQ_7,CRQ_8,CRQ_9,CRQ_10,CRQ_11,CRQ_12,CRQ_13,CRQ_14,CRQ_15,CRQ_16,CRQ_17,CRQ_18,CRQ_19,CRQ_20,CRQ_21,CRQ_22,CRQ_23,CRQ_24,CRQ_25,CRQ_26,CRQ_27)))/27),
         CRQ_mean=rowMeans(cbind(CRQ_1,CRQ_2,CRQ_3,CRQ_4,CRQ_5,CRQ_6,CRQ_7,CRQ_8,CRQ_9,CRQ_10,CRQ_11,CRQ_12,CRQ_13,CRQ_14,CRQ_15,CRQ_16,CRQ_17,CRQ_18,CRQ_19,CRQ_20,CRQ_21,CRQ_22,CRQ_23,CRQ_24,CRQ_25,CRQ_26,CRQ_27),na.rm=T),
         CRQ_total=rowSums(cbind(CRQ_1,CRQ_2,CRQ_3,CRQ_4,CRQ_5,CRQ_6,CRQ_7,CRQ_8,CRQ_9,CRQ_10,CRQ_11,CRQ_12,CRQ_13,CRQ_14,CRQ_15,CRQ_16,CRQ_17,CRQ_18,CRQ_19,CRQ_20,CRQ_21,CRQ_22,CRQ_23,CRQ_24,CRQ_25,CRQ_26,CRQ_27), na.rm=F),
         CRQ_rehashing_total=rowSums(cbind(CRQ_13,CRQ_14,CRQ_15,CRQ_16,CRQ_17,CRQ_18,CRQ_19,CRQ_20,CRQ_21,CRQ_22,CRQ_23,CRQ_24,CRQ_25,CRQ_26,CRQ_27), na.rm=F),
         CRQ_rehashing_mean=round(rowMeans(cbind(CRQ_13,CRQ_14,CRQ_15,CRQ_16,CRQ_17,CRQ_18,CRQ_19,CRQ_20,CRQ_21,CRQ_22,CRQ_23,CRQ_24,CRQ_25,CRQ_26,CRQ_27), na.rm=T),3),
         CRQ_mulling_total=rowSums(cbind(CRQ_3,CRQ_4,CRQ_7,CRQ_8,CRQ_9,CRQ_11,CRQ_12), na.rm=F),
         CRQ_mulling_mean=round(rowMeans(cbind(CRQ_3,CRQ_4,CRQ_7,CRQ_8,CRQ_9,CRQ_11,CRQ_12), na.rm=T),3),
         CRQ_problemtalk_total=rowSums(cbind(CRQ_2,CRQ_5,CRQ_6,CRQ_10), na.rm=F),
         CRQ_problemtalk_mean=round(rowMeans(cbind(CRQ_2,CRQ_5,CRQ_6,CRQ_10), na.rm=T),3))

## Save it
CRQ_Wave1_outdf <- CRQ_Wave1 %>% filter(!grepl("W2|W3|W4|W5|W6",survey_name)) %>% 
  filter(!grepl("TAG3|TAG4",tagid)) 
CRQ_Wave1_TAG2_outdf <- CRQ_Wave1 %>% filter(!grepl("W2|W3|W4|W5|W6",survey_name)) %>% 
  filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(CRQ_Wave1_outdf, file = paste0(workdir,"Qualtrics_Output/Wave1/CRQ_Wave1.csv"))
write.csv(CRQ_Wave1_TAG2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave1/CRQ_Wave1_TAG2.csv"))

CRQ_Wave2_outdf <- CRQ_Wave1 %>% filter(grepl("W2",survey_name)) %>% 
  filter(!grepl("TAG3|TAG4",tagid))
write.csv(CRQ_Wave2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave2/CRQ_Wave2.csv"))

CRQ_Wave2_TAG2_outdf <- CRQ_Wave1 %>% filter(grepl("W2",survey_name)) %>% 
  filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(CRQ_Wave2_TAG2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave2/CRQ_Wave2_TAG2.csv"))

CRQ_Wave3_outdf <- CRQ_Wave1 %>% filter(grepl("W3",survey_name)) %>% 
  filter(!grepl("TAG3|TAG4",tagid)) 
write.csv(CRQ_Wave3_outdf, file = paste0(workdir,"Qualtrics_Output/Wave3/CRQ_Wave3.csv"))

CRQ_Wave3_TAG2_outdf <- CRQ_Wave1 %>% filter(grepl("W3",survey_name)) %>% 
  filter(!grepl("TAG0|TAG1|TAG2",tagid))
write.csv(CRQ_Wave3_TAG2_outdf, file = paste0(workdir,"Qualtrics_Output/Wave3/CRQ_Wave3_TAG2.csv"))

CRQ_Wave4_outdf <- CRQ_Wave1 %>% filter(grepl("W4",survey_name)) 
write.csv(CRQ_Wave4_outdf, file = paste0(workdir,"Qualtrics_Output/Wave4/CRQ_Wave4.csv"))

CRQ_Wave5_outdf <- CRQ_Wave1 %>% filter(grepl("W5",survey_name)) 
write.csv(CRQ_Wave5_outdf, file = paste0(workdir,"Qualtrics_Output/Wave5/CRQ_Wave5.csv"))

CRQ_Wave6_outdf <- CRQ_Wave1 %>% filter(grepl("W6",survey_name)) 
write.csv(CRQ_Wave6_outdf, file = paste0(workdir,"Qualtrics_Output/Wave6/CRQ_Wave6.csv"))
```
