```{r}
## Make RDOC ready file
ndar_cbcl_data <- left_join(CBCL_Wave1,distinct(redcap_cleaned, tagid, dob),by="tagid") %>%
  filter(!is.na(survey_date),!survey_date=="") %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         sex="F",
         relationship=ifelse(P_Gender==1 && P_Relation==1,2,
                             ifelse(P_Gender==2 && P_Relation==1,1,
                                    ifelse(P_Gender==1 && P_Relation==2,18,
                                           ifelse(P_Gender==2 && P_Relation==2,17,
                                                  ifelse(P_Gender==1 && P_Relation==3,24,
                                                         ifelse(P_Gender==2 && P_Relation==3,23,
                                                                ifelse(P_Gender==1 && P_Relation==4,20,
                                                                       ifelse(P_Gender==2 && P_Relation==4,19,
                                                                              ifelse(P_Gender==1 && P_Relation==5,22,
                                                                                     ifelse(P_Gender==2 && P_Relation==5,21,
                                                                                            ifelse(P_Gender==1 && P_Relation==6,84,
                                                                                                   ifelse(P_Gender==2 && P_Relation==6,82,NA)))))))))))),
         study="Transitions in Adolescent Girls (TAG) Study",
         best_things=BestThings,
         cbcl_disability=Disability,
         nfriend=Friends_Number,
         #cbcl_child_gender=P_Gender,
         cbcl_parent_relationship=P_Relation,
         sports_des1=Sport_List_1,
         sports_des2=Sport_List_2,
         sports_des3=Sport_List_3,
         sports_time1=ifelse(!is.na(Sport_Time_1),as.numeric(Sport_Time_1),999),
         sports_well1=ifelse(!is.na(Sport_Well_1),as.numeric(Sport_Well_1),999),
         sports_time2=ifelse(!is.na(Sport_Time_2),as.numeric(Sport_Time_2),999),
         sports_well2=ifelse(!is.na(Sport_Well_2),as.numeric(Sport_Well_2),999),
         sports_time3=ifelse(!is.na(Sport_Time_3),as.numeric(Sport_Time_3),999),
         sports_well3=ifelse(!is.na(Sport_Well_3),as.numeric(Sport_Well_3),999),
         activities_des1=Hobby_List_1,
         activities_time1=as.numeric(Hobby_Time_1),
         activities_well1=as.numeric(Hobby_Well_1),
         activities_des2=Hobby_List_2,
         activities_time2=as.numeric(Hobby_Time_2),
         activities_well2=as.numeric(Hobby_Well_2),
         activities_des3=Hobby_List_3,
         activities_time3=as.numeric(Hobby_Time_3),
         activities_well3=as.numeric(Hobby_Well_3),
         clubs_des1=Clubs_List_1,
         clubs_active1=as.numeric(ClubActive_1),
         clubs_des2=Clubs_List_2,
         clubs_active2=as.numeric(ClubActive_2),
         clubs_des3=Clubs_List_3,
         clubs_active3=as.numeric(ClubActive_3),
         chores_des1=Chores_List_1,
         chores_well1=as.numeric(Chore_Well_1),
         chores_des2=Chores_List_2,
         chores_well2=as.numeric(Chore_Well_2),
         chores_des3=Chores_List_3,
         chores_well3=as.numeric(Chore_Well_3),
         friends=Friends_Number,
         friends_time=Friends_Time,
         interp_siblings=as.numeric(How_Well_Get_Along_Sibs),
         interp_kids=as.numeric(How_Well_Get_Along_Kids),
         interp_parents=as.numeric(How_Well_Behave_Parents),
         interp_alone=as.numeric(How_Well_Play_Work_Alone),
         cbcl1=ifelse(!is.na(VIII_1),VIII_1,999),
         cbcl2=ifelse(!is.na(VIII_2),VIII_2,999),
         cbcl3=ifelse(!is.na(VIII_3),VIII_3,999),
         cbcl4=ifelse(!is.na(VIII_4),VIII_4,999),
         cbcl5=ifelse(!is.na(VIII_5),VIII_5,999),
         cbcl6=ifelse(!is.na(VIII_6),VIII_6,999),
         cbcl7=ifelse(!is.na(VIII_7),VIII_7,999),
         cbcl8=ifelse(!is.na(VIII_8),VIII_8,999),
         cbcl9=ifelse(!is.na(VIII_9),VIII_9,999),
         cbcl10=ifelse(!is.na(VIII_10),VIII_10,999),
         cbcl11=ifelse(!is.na(VIII_11),VIII_11,999),
         cbcl12=ifelse(!is.na(VIII_12),VIII_12,999),
         cbcl13=ifelse(!is.na(VIII_13),VIII_13,999),
         cbcl14=ifelse(!is.na(VIII_14),VIII_14,999),
         cbcl15=ifelse(!is.na(VIII_15),VIII_15,999),
         cbcl16=ifelse(!is.na(VIII_16),VIII_16,999),
         cbcl17=ifelse(!is.na(VIII_17),VIII_17,999),
         cbcl18=ifelse(!is.na(VIII_18),VIII_18,999),
         cbcl19=ifelse(!is.na(VIII_19),VIII_19,999),
         cbcl20=ifelse(!is.na(VIII_20),VIII_20,999),
         cbcl21=ifelse(!is.na(VIII_21),VIII_21,999),
         cbcl22=ifelse(!is.na(VIII_22),VIII_22,999),
         cbcl23=ifelse(!is.na(VIII_23),VIII_23,999),
         cbcl24=ifelse(!is.na(VIII_24),VIII_24,999),
         cbcl25=ifelse(!is.na(VIII_25),VIII_25,999),
         cbcl26=ifelse(!is.na(VIII_26),VIII_26,999),
         cbcl27=ifelse(!is.na(VIII_27),VIII_27,999),
         cbcl28=ifelse(!is.na(VIII_28),VIII_28,999),
         cbcl29=ifelse(!is.na(VIII_29),VIII_29,999),
         cbcl30=ifelse(!is.na(VIII_30),VIII_30,999),
         cbcl31=ifelse(!is.na(VIII_31),VIII_31,999),
         cbcl32=ifelse(!is.na(VIII_32),VIII_32,999),
         cbcl33=ifelse(!is.na(VIII_33),VIII_33,999),
         cbcl34=ifelse(!is.na(VIII_34),VIII_34,999),
         cbcl35=ifelse(!is.na(VIII_35),VIII_35,999),
         cbcl36=ifelse(!is.na(VIII_36),VIII_36,999),
         cbcl37=ifelse(!is.na(VIII_37),VIII_37,999),
         cbcl38=ifelse(!is.na(VIII_38),VIII_38,999),
         cbcl39=ifelse(!is.na(VIII_39),VIII_39,999),
         cbcl40=ifelse(!is.na(VIII_40),VIII_40,999),
         cbcl41=ifelse(!is.na(VIII_41),VIII_41,999),
         cbcl42=ifelse(!is.na(VIII_42),VIII_42,999),
         cbcl43=ifelse(!is.na(VIII_43),VIII_43,999),
         cbcl44=ifelse(!is.na(VIII_44),VIII_44,999),
         cbcl45=ifelse(!is.na(VIII_45),VIII_45,999),
         cbcl46=ifelse(!is.na(VIII_46),VIII_46,999),
         cbcl47=ifelse(!is.na(VIII_47),VIII_47,999),
         cbcl48=ifelse(!is.na(VIII_48),VIII_48,999),
         cbcl49=ifelse(!is.na(VIII_49),VIII_49,999),
         cbcl50=ifelse(!is.na(VIII_50),VIII_50,999),
         cbcl51=ifelse(!is.na(VIII_51),VIII_51,999),
         cbcl52=ifelse(!is.na(VIII_52),VIII_52,999),
         cbcl53=ifelse(!is.na(VIII_53),VIII_53,999),
         cbcl54=ifelse(!is.na(VIII_54),VIII_54,999),
         cbcl55=ifelse(!is.na(VIII_55),VIII_55,999),
         cbcl56a=ifelse(!is.na(VIII_56a),VIII_56a,999),
         cbcl56b=ifelse(!is.na(VIII_56b),VIII_56b,999),
         cbcl56c=ifelse(!is.na(VIII_56c),VIII_56c,999),
         cbcl56d=ifelse(!is.na(VIII_56d),VIII_56d,999),
         cbcl56e=ifelse(!is.na(VIII_56e),VIII_56e,999),
         cbcl56f=ifelse(!is.na(VIII_56f),VIII_56f,999),
         cbcl56g=ifelse(!is.na(VIII_56g),VIII_56g,999),
         cbcl56h=ifelse(!is.na(VIII_56h),as.numeric(VIII_56h),999),
         cbcl57=ifelse(!is.na(VIII_57),VIII_57,999),
         cbcl58=ifelse(!is.na(VIII_58),VIII_58,999),
         cbcl59=ifelse(!is.na(VIII_59),VIII_59,999),
         cbcl60=ifelse(!is.na(VIII_60),VIII_60,999),
         cbcl61=ifelse(!is.na(VIII_61),VIII_61,999),
         cbcl62=ifelse(!is.na(VIII_62),VIII_62,999),
         cbcl63=ifelse(!is.na(VIII_63),VIII_63,999),
         cbcl64=ifelse(!is.na(VIII_64),VIII_64,999),
         cbcl65=ifelse(!is.na(VIII_65),VIII_65,999),
         cbcl66=ifelse(!is.na(VIII_66),VIII_66,999),
         cbcl67=ifelse(!is.na(VIII_67),VIII_67,999),
         cbcl68=ifelse(!is.na(VIII_68),VIII_68,999),
         cbcl69=ifelse(!is.na(VIII_69),VIII_69,999),
         cbcl70=ifelse(!is.na(VIII_70),as.numeric(VIII_70),999),
         cbcl71=ifelse(!is.na(VIII_71),VIII_71,999),
         cbcl72=ifelse(!is.na(VIII_72),VIII_72,999),
         cbcl73=ifelse(!is.na(VIII_73),VIII_73,999),
         cbcl74=ifelse(!is.na(VIII_74),VIII_74,999),
         cbcl75=ifelse(!is.na(VIII_75),VIII_75,999),
         cbcl76=ifelse(!is.na(VIII_76),VIII_76,999),
         cbcl77=ifelse(!is.na(VIII_77),VIII_77,999),
         cbcl78=ifelse(!is.na(VIII_78),VIII_78,999),
         cbcl79=ifelse(!is.na(VIII_79),VIII_79,999),
         cbcl80=ifelse(!is.na(VIII_80),VIII_80,999),
         cbcl81=ifelse(!is.na(VIII_81),VIII_81,999),
         cbcl82=ifelse(!is.na(VIII_82),VIII_82,999),
         cbcl83=ifelse(!is.na(VIII_83),VIII_83,999),
         cbcl84=ifelse(!is.na(VIII_84),VIII_84,999),
         cbcl85=ifelse(!is.na(VIII_85),VIII_85,999),
         cbcl86=ifelse(!is.na(VIII_86),VIII_86,999),
         cbcl87=ifelse(!is.na(VIII_87),VIII_87,999),
         cbcl88=ifelse(!is.na(VIII_88),VIII_88,999),
         cbcl89=ifelse(!is.na(VIII_89),VIII_89,999),
         cbcl90=ifelse(!is.na(VIII_90),VIII_90,999),
         cbcl91=ifelse(!is.na(VIII_91),VIII_91,999),
         cbcl92=ifelse(!is.na(VIII_92),VIII_92,999),
         cbcl93=ifelse(!is.na(VIII_93),VIII_93,999),
         cbcl94=ifelse(!is.na(VIII_94),VIII_94,999),
         cbcl95=ifelse(!is.na(VIII_95),VIII_95,999),
         cbcl96=ifelse(!is.na(VIII_96),VIII_96,999),
         cbcl97=ifelse(!is.na(VIII_97),VIII_97,999),
         cbcl98=ifelse(!is.na(VIII_98),VIII_98,999),
         cbcl99=ifelse(!is.na(VIII_99),VIII_99,999),VIII_99,
         cbcl100=ifelse(!is.na(VIII_100),VIII_100,999),
         cbcl101=ifelse(!is.na(VIII_101),VIII_101,999),
         cbcl102=ifelse(!is.na(VIII_102),VIII_102,999),
         cbcl103=ifelse(!is.na(VIII_103),VIII_103,999),
         cbcl104=ifelse(!is.na(VIII_104),VIII_104,999),
         cbcl105=ifelse(!is.na(VIII_105),VIII_105,999),
         cbcl106=ifelse(!is.na(VIII_106),VIII_106,999),
         cbcl107=ifelse(!is.na(VIII_107),VIII_107,999),
         cbcl108=ifelse(!is.na(VIII_108),VIII_108,999),
         cbcl109=ifelse(!is.na(VIII_109),VIII_109,999),
         cbcl110=ifelse(!is.na(VIII_110),VIII_110,999),
         cbcl111=ifelse(!is.na(VIII_111),VIII_111,999),
         cbcl112=ifelse(!is.na(VIII_112),VIII_112,999),
         special_ed_des=What_Kind,
         cbcl_emotional_raw=999,
         cbcl_emotional=999,
         cbcl_anxious_raw=999,
         cbcl_anxious=999,
         cbcl_somatic_c_raw=999,
         cbcl_somatic_c=999,
         cbcl_withdrawn_raw=999,
         cbcl_withdrawn=999,
         cbcl_sleep_raw=999,
         cbcl_sleep=999,
         cbcl_attention_raw=999,
         cbcl_attention=999,
         cbcl_aggressive_raw=999,
         cbcl_aggressive=999,
         cbcl_internal_raw=999,
         cbcl_internal=999,
         cbcl_external_raw=999,
         cbcl_external=999,
         cbcl_total_raw=999,
         cbcl_total=999,
         cbcl_affective_raw=999,
         cbcl_affective=999,
         cbcl_anxiety_raw=999,
         cbcl_anxiety=999,
         cbcl_pervasive_raw=999,
         cbcl_pervasive=999,
         cbcl_adhd_raw=999,
         cbcl_adhd=999,
         cbcl_oppositional_raw=999,
         cbcl_oppositional=999,
         cbcl_social_p_raw=999,
         cbcl_social_p=999,
         cbcl_thought_raw=999,
         cbcl_thought=999,
         cbcl_rulebreak_raw=999,
         cbcl_rulebreak=999,
         cbcl_activities_raw=999,
         cbcl_activities=999,
         cbcl_social_c_raw=999,
         cbcl_social_c=999,
         cbcl_school_raw=999,
         cbcl_school=999,
         cbcl_total_c_raw=999,
         cbcl_total_c=999,
         cbcl_somatic_p_raw=999,
         cbcl_somatic_p=999,
         cbcl_conduct_raw=999,
         cbcl_conduct=999,
         cbcl_sct_raw=999,
         cbcl_sct=999,
         cbcl_ocd_raw=999,
         cbcl_ocd=999,
         cbcl_ptsd_raw=999,
         cbcl_ptsd=999,
         cbcl_depresspr=999,
         cbcl_depresspr_raw=999, 
         interp_kids=ifelse(interp_kids==3, 9, interp_kids),
         interp_parents=ifelse(interp_parents==3, 9, interp_parents),
         interp_alone=ifelse(interp_alone==3, 9, interp_alone))

ndar_cbcl_data <- left_join(ndar_key,ndar_cbcl_data, by="tagid") %>%
  mutate(src_subject_id=anontagid,
         subjectkey=guid) %>%
  filter(!is.na(subjectkey),
         !interview_age=="") %>%
  select(-contains("CBCL",ignore.case = FALSE),-dob,-survey_date,-survey_name,-tagid,-anontagid,-ID,-guid,-survey_type,-BestThings,-What_Kind,-contains("vii"),-contains("sport_"),-contains("chore_"),-contains("chores_list"),-contains("clubactive_"),-contains("clubs_list"),-contains("grades_"),-contains("hobby_"),-contains("how_"),-contains("edu_"),-Disability,-Friends_Number,-Friends_Time,-contains("p_e"),-P_Gender,-P_Relation,-contains("p_work"),-Reasons,-Rep_Grade,-best_things, -contains("p_relationship"))
cbcl_df_header<-rep(NA,length(read.csv(paste0(workdir,"RDoCdb/templates/cbcl01_template.csv"), header = FALSE, stringsAsFactors = FALSE)))
cbcl_df_header[1]<-read.csv(paste0(workdir,"RDoCdb/templates/cbcl01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,1]
cbcl_df_header[2]<-read.csv(paste0(workdir,"RDoCdb/templates/cbcl01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,2]

cbcl_temp<-as.list(read.csv(paste0(workdir,"RDoCdb/templates/cbcl01_template.csv"), header = TRUE, stringsAsFactors = FALSE, skip=1))
cbcl_temp_df<-data.frame(cbcl_temp)
ndar_cbcl_data<-rbind(cbcl_temp_df,ndar_cbcl_data)#[c(1:429)]

part2<-colnames(ndar_cbcl_data)
part3<-as.matrix(ndar_cbcl_data)
colnames(part3)<-NULL
together<-rbind(cbcl_df_header,part2,part3)
write.table(together,file =paste0(workdir,"RDoCdb/output/jul2025/cbcl01.csv"),sep=",",na = "",row.names=FALSE,col.names=FALSE)
rm(together,part2,part3,cbcl_df_header,cbcl_temp,cbcl_temp_df,CBCL,CBCL_Wave1)
```
