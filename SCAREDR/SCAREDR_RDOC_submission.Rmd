```{r}
## Make RDOC ready file
ndar_scared_data <- left_join(SCARED_Wave1,distinct(redcap_cleaned, tagid, dob),by="tagid") %>%
  filter(!is.na(survey_date),!survey_date=="") %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         sex="F",
         scared_version="Brief",
         visit=ifelse(grepl("Sess 1",survey_name),"Session1",
                      ifelse(grepl("Session 1",survey_name),"Session1",
                             ifelse(grepl("Sess 2",survey_name),"Session2",
                                    ifelse(grepl("Session 2",survey_name),"Session2",
                                           ifelse(grepl("Home",survey_name),"Home Questionnaires",NA))))),
         comments_misc="SCARED Brief Assessment of Anxiety and PTS Symptoms (ages 7-17)",
         scared_24=ifelse(!is.na(SCARED_R_1),SCARED_R_1,88),
         scared_25=ifelse(!is.na(SCARED_R_2),SCARED_R_2,88),
         scared_28=ifelse(!is.na(SCARED_R_3),SCARED_R_3,88),
         scared_36=ifelse(!is.na(SCARED_R_4),SCARED_R_4,88),
         scared_41=ifelse(!is.na(SCARED_R_5),SCARED_R_5,88),
         briefscared_1=ifelse(!is.na(SCARED_R_6),SCARED_R_6,88),
         briefscared_2=ifelse(!is.na(SCARED_R_7),SCARED_R_7,88),
         briefscared_3=ifelse(!is.na(SCARED_R_8),SCARED_R_8,88),
         briefscared_4=ifelse(!is.na(SCARED_R_9),SCARED_R_9,88),
         scared_total=999,
         scared_ptsd_score=ifelse(!is.na(SCARED_ptsd_total),SCARED_ptsd_total,999),
         scared_pd_score=999,
         scared_gad_score=999,
         scared_sad_score=999,
         scared_socad_score=999,
         scared_ssa_score=999)

ndar_scared_data <- left_join(ndar_key,ndar_scared_data, by="tagid") %>%
  mutate(src_subject_id=anontagid,
         subjectkey=guid) %>%
  filter(!is.na(subjectkey),
         !interview_age=="") %>%
  select(-contains("SCARED",ignore.case = FALSE),-dob,-survey_date,-survey_name,-tagid,-anontagid,-ID,-guid,-survey_type)
scared_df_header<-rep(NA,length(read.csv(paste0(workdir,"RDoCdb/templates/scared01_template.csv"), header = FALSE, stringsAsFactors = FALSE)))
scared_df_header[1]<-read.csv(paste0(workdir,"RDoCdb/templates/scared01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,1]
scared_df_header[2]<-read.csv(paste0(workdir,"RDoCdb/templates/scared01_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,2]

scared_temp<-as.list(read.csv(paste0(workdir,"RDoCdb/templates/scared01_template.csv"), header = TRUE, stringsAsFactors = FALSE, skip=1))
scared_temp_df<-data.frame(scared_temp)
ndar_scared_data<-rbind(scared_temp_df,ndar_scared_data)

part2<-colnames(ndar_scared_data)
part3<-as.matrix(ndar_scared_data)
colnames(part3)<-NULL
together<-rbind(scared_df_header,part2,part3)
write.table(together,file =paste0(workdir,"RDoCdb/output/jul2025/scared01.csv"),sep=",",na = "",row.names=FALSE,col.names=FALSE)
rm(together,part2,part3,scared_df_header,scared_temp,scared_temp_df,SCARED,SCARED_Wave1,SCARED_Wave1_means,SCARED_Wave1_means_graph,
   SCARED_Wave1_totals,SCARED_Wave1_totals_graph)
```
