```{r}
## Make RDOC ready file
ndar_bfi10_data <- left_join(BFI10_Wave1,distinct(redcap_cleaned, tagid, dob),by="tagid") %>%
  mutate(interview_date=paste0(sprintf("%02d",month(survey_date)),"/",sprintf("%02d",day(survey_date)),"/",year(survey_date)),
         interview_age=round((interval(start =dob, end = survey_date) / duration(num = 1, units = "months")),0),
         sex="F",
         bfi10_1=BFI_10_1,
         bfi10_2=BFI_10_2,
         bfi10_3=BFI_10_3,
         bfi10_4=BFI_10_4,
         bfi10_5=BFI_10_5,
         bfi10_6=BFI_10_6,
         bfi10_7=BFI_10_7,
         bfi10_8=BFI_10_8,
         bfi10_9=BFI_10_9,
         bfi10_10=BFI_10_10
  )
ndar_bfi10_data <- left_join(ndar_key,ndar_bfi10_data, by="tagid") %>%
  mutate(src_subject_id=anontagid,
         subjectkey=guid) %>%
  filter(!is.na(subjectkey),
         !interview_age=="") %>%
  select(-contains("BFI",ignore.case = FALSE),-dob,-survey_date,-survey_type,-survey_name,-tagid,-anontagid,-ID,-guid)
bfi10_df_header<-rep(NA,length(read.csv(paste0(workdir,"RDoCdb/templates/bfi1001_template.csv"), header = FALSE, stringsAsFactors = FALSE)))
bfi10_df_header[1]<-read.csv(paste0(workdir,"RDoCdb/templates/bfi1001_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,1]
bfi10_df_header[2]<-read.csv(paste0(workdir,"RDoCdb/templates/bfi1001_template.csv"), header = FALSE, stringsAsFactors = FALSE)[1,2]

bfi10_temp<-as.list(read.csv(paste0(workdir,"RDoCdb/templates/bfi1001_template.csv"), header = TRUE, stringsAsFactors = FALSE, skip=1))
bfi10_temp_df<-data.frame(bfi10_temp)
ndar_bfi10_data<-rbind(bfi10_temp_df,ndar_bfi10_data)

part2<-colnames(ndar_bfi10_data)
part3<-as.matrix(ndar_bfi10_data)
colnames(part3)<-NULL
together<-rbind(bfi10_df_header,part2,part3)
write.table(together,file =paste0(workdir,"RDoCdb/output/jul2025/bfi1001.csv"),sep=",",na = "",row.names=FALSE,col.names=FALSE)
rm(BFI10,BFI10_Wave1,BFI10_Wave1_means,BFI10_Wave1_means_graph,BFI10_Wave1_totals,BFI10_Wave1_totals_graph,
   bfi10_df_header,bfi10_temp,bfi10_temp_df,part3,part2,together)
```
